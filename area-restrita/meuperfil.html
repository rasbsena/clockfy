<script>
        // ========================================
        // FUNÇÃO PARA BUSCAR DADOS DE FORMA INTELIGENTE
        // ========================================
        function getSafeData(keyDirect, keyObj, keyProp) {
            // 1. Tenta pegar a chave direta (ex: 'usuario_nome')
            let val = localStorage.getItem(keyDirect);
            
            // 2. Se não achou, tenta buscar dentro do objeto JSON (ex: 'usuario' -> 'nome')
            if (!val || val === 'undefined' || val === 'null') {
                try {
                    const objRaw = localStorage.getItem(keyObj);
                    if (objRaw) {
                        const obj = JSON.parse(objRaw);
                        val = obj[keyProp];
                    }
                } catch (e) {
                    console.log(`Erro ao ler ${keyObj}`, e);
                }
            }
            return val;
        }

        document.addEventListener('DOMContentLoaded', () => {
            
            // ========================================
            // 1. VERIFICAÇÃO DE SEGURANÇA
            // ========================================
            const autenticado = localStorage.getItem('autenticado');
            // Se quiser forçar o login caso não tenha token, descomente a linha abaixo:
            // if (autenticado !== 'true') window.location.href = "../index.html"; 

            // ========================================
            // 2. RECUPERAÇÃO DE DADOS (Lógica Robusta)
            // ========================================
            
            // NOME: Tenta 'usuario_nome', depois tenta ler dentro do objeto 'usuario'
            let nome = getSafeData('usuario_nome', 'usuario', 'nome') || 'Usuário';

            // EMAIL
            let email = getSafeData('usuario_email', 'usuario', 'email') || 'Não informado';

            // EMPRESA: Tenta 'empresa_nome', depois objeto 'empresa', depois 'razao_social'
            let empresa = getSafeData('empresa_nome', 'empresa', 'nome');
            if (!empresa) empresa = getSafeData('empresa_nome', 'empresa', 'razao_social') || 'Empresa';

            // ID
            let id = localStorage.getItem('id_funcionario');
            // Fallback se o ID estiver dentro do objeto usuario
            if (!id) id = getSafeData(null, 'usuario', 'id');
            if (!id) id = '---';

            // CARGO
            let cargo = getSafeData('usuario_cargo', 'usuario', 'cargo') || 'Colaborador';

            // FOTO
            let foto = getSafeData('usuario_foto', 'usuario', 'foto_perfil');
            if (!foto) foto = getSafeData(null, 'usuario', 'foto'); // Tenta variações
            if (!foto) foto = getSafeData(null, 'usuario', 'avatar');

            // ========================================
            // 3. PREENCHIMENTO DA TELA
            // ========================================
            
            // Atualiza Textos
            document.getElementById('displayName').textContent = nome;
            document.getElementById('displayRole').textContent = cargo;
            document.getElementById('displayEmail').value = email;
            document.getElementById('displayCompany').value = empresa;
            document.getElementById('displayId').value = `#${id}`;

            // Atualiza Foto (se existir)
            if (foto && foto.length > 10) { 
                const imgElement = document.getElementById('userPhoto');
                const iconElement = document.getElementById('defaultAvatar');
                
                imgElement.src = foto;
                imgElement.style.display = 'block';
                iconElement.style.display = 'none';
            }

            // Debug no console para você ver o que está vindo
            console.log('Dados Carregados:', { nome, email, empresa, id, cargo });
        });

        // ========================================
        // 4. BOTÕES
        // ========================================
        function goBack() {
            window.location.href = 'clockfyregistro.html'; 
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.clear();
                window.location.href = "../index.html";
            }
        }
    </script>
