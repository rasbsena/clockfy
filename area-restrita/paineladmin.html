<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clockfy - Painel Admin</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23270949' d='M50,5L25,35h50L50,5z'/%3E%3Ccircle fill='%23f93d00' cx='50' cy='60' r='35'/%3E%3Ccircle fill='%23270949' cx='50' cy='60' r='28'/%3E%3Ccircle fill='%23fff' cx='50' cy='60' r='23'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --roxo-escuro: #270949;
      --roxo-medio: #87148C;
      --roxo-vivo: #4F1295;
      --laranja: #F93D00;
      --laranja-esc: #e03800;
      --branco: #fff;
      --vidro: rgba(39, 9, 73, 0.6);
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #270949 0%, #1a0430 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--vidro);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(249, 61, 0, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 50px;
      height: 50px;
    }

    .header-title {
      font-size: 28px;
      font-weight: 800;
    }

    .header-title span {
      color: var(--laranja);
    }

    .admin-badge {
      background: var(--laranja);
      color: #fff;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn {
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
    }

    .btn-primary {
      background: var(--laranja);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--laranja-esc);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(249, 61, 0, 0.4);
    }

    .btn-ghost {
      background: transparent;
      color: #fff;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.4);
    }

    /* MAIN GRID */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .top-section {
      display: grid;
      grid-template-columns: 450px 1fr;
      gap: 20px;
    }

    .actions-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .card {
      background: var(--vidro);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(249, 61, 0, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-subtitle {
      color: #a8a8a8;
      font-size: 14px;
      margin-bottom: 20px;
    }

    /* BUSCA */
    .search-section {
      margin-bottom: 20px;
    }

    .search-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #e0e0e0;
    }

    .search-input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      background: rgba(20, 5, 35, 0.8);
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--laranja);
      background: rgba(20, 5, 35, 0.95);
    }

    .search-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* SUGEST√ïES */
    .suggestions {
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }

    .suggestions.show {
      display: block;
    }

    .suggestion-item {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .suggestion-item:hover {
      background: rgba(249, 61, 0, 0.1);
      border-color: rgba(249, 61, 0, 0.3);
      transform: translateX(5px);
    }

    .suggestion-name {
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }

    .suggestion-info {
      font-size: 12px;
      color: #a8a8a8;
    }

    .no-results {
      padding: 20px;
      text-align: center;
      color: #a8a8a8;
      font-size: 14px;
    }

    /* FUNCION√ÅRIO SELECIONADO */
    .selected-employee {
      padding: 20px;
      background: rgba(249, 61, 0, 0.1);
      border: 2px solid rgba(249, 61, 0, 0.3);
      border-radius: 16px;
    }

    .selected-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .selected-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--laranja);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .selected-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 4px;
    }

    .selected-id {
      font-size: 13px;
      color: #a8a8a8;
    }

    .btn-clear {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-clear:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
    }

    .selected-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .detail-item {
      font-size: 13px;
    }

    .detail-label {
      color: #a8a8a8;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .detail-value {
      color: #fff;
      font-weight: 500;
    }

    /* MENU DE A√á√ïES */
    .actions-menu {
      display: none;
    }

    .actions-menu.show {
      display: block;
    }

    .action-btn {
      width: 100%;
      padding: 20px;
      background: var(--vidro);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(249, 61, 0, 0.2);
      border-radius: 16px;
      color: #fff;
      font-weight: 600;
      font-size: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      font-family: 'Montserrat', sans-serif;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .action-btn:hover {
      background: rgba(249, 61, 0, 0.15);
      border-color: rgba(249, 61, 0, 0.5);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(249, 61, 0, 0.3);
    }

    .action-icon {
      font-size: 32px;
    }

    .action-text {
      font-size: 14px;
      font-weight: 700;
    }

    /* √ÅREA DE FORMUL√ÅRIOS */
    .form-area {
      display: none;
    }

    .form-area.show {
      display: block;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid rgba(249, 61, 0, 0.2);
    }

    .form-title {
      font-size: 22px;
      font-weight: 700;
      color: #fff;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #e0e0e0;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      background: rgba(20, 5, 35, 0.8);
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--laranja);
      background: rgba(20, 5, 35, 0.95);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .message {
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 14px;
      margin-top: 16px;
      display: none;
      animation: slideIn 0.3s ease;
    }

    .message.show {
      display: block;
    }

    .message.success {
      background: rgba(34, 197, 94, 0.15);
      border: 1px solid rgba(34, 197, 94, 0.4);
      color: #86efac;
    }

    .message.error {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.4);
      color: #fca5a5;
    }

    /* AVISO IMPORTANTE (NOVO) */
    .warning-box {
      background: rgba(255, 145, 0, 0.1);
      border: 1px solid rgba(255, 145, 0, 0.4);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .warning-icon {
      font-size: 20px;
      color: #ff9100;
    }

    .warning-text {
      font-size: 13px;
      color: #e0e0e0;
      line-height: 1.5;
    }

    .warning-text strong {
      color: #ff9100;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 1200px) {
      .top-section {
        grid-template-columns: 1fr;
      }

      .actions-section {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .actions-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <script>
    const role = localStorage.getItem('role');
    const usuarioJson = localStorage.getItem('usuario');
    let isAdmin = false;

    // 1. Verifica role direta (Case Insensitive)
    if (role && (role === 'Admin' || role.toLowerCase() === 'admin')) {
      isAdmin = true;
    } 
    // 2. Verifica dentro do objeto usuario (JSON)
    else if (usuarioJson) {
      try {
        const usuario = JSON.parse(usuarioJson);
        
        // Verifica se √© string dupla
        let userObj = usuario;
        if (typeof usuario === 'string') userObj = JSON.parse(usuario);

        // Verifica nivel_acesso
        if (userObj.nivel_acesso && userObj.nivel_acesso.toLowerCase() === 'admin') {
          isAdmin = true;
        }
        // Verifica role interna
        else if (userObj.role && userObj.role.toLowerCase() === 'admin') {
          isAdmin = true;
        }
      } catch (e) {
        console.error("Erro parsing usuario JSON", e);
      }
    }

    // Prote√ß√£o de redirecionamento
    if (!isAdmin) {
      alert('Acesso negado! Apenas administradores podem acessar esta √°rea.');
      window.location.href = 'painel.html';
    }
  </script>

  <div class="container">
    <header class="header">
      <div class="header-left">
        <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
          <path fill="#270949" d="M50,5L25,35h50L50,5z"/>
          <circle fill="#f93d00" cx="50" cy="60" r="35"/>
          <circle fill="#270949" cx="50" cy="60" r="28"/>
          <circle fill="#fff" cx="50" cy="60" r="23"/>
        </svg>
        <div>
          <div class="header-title">Clock<span>fy</span></div>
          <div class="admin-badge">‚öôÔ∏è Admin</div>
        </div>
      </div>
      <div>
        <button class="btn btn-ghost" onclick="window.location.href='dados-empresa.html'" style="margin-right: 10px;">
          üè¢ Dados da Empresa
        </button>
        <button class="btn btn-ghost" onclick="window.location.href='https://clockfy.upperfy.com.br/area-restrita/adduser.html'" style="margin-right: 10px;">
          + Adicionar Funcion√°rio
        </button>
        <button class="btn btn-ghost" onclick="window.location.href='painel.html'" style="margin-right: 10px;">
          ‚Üê Voltar ao Painel
        </button>
        <button class="btn btn-primary" onclick="logout()">Sair</button>
      </div>
    </header>

    <div class="main-grid">
      <div class="top-section">
        <div class="card">
          <h2 class="card-title">üîç Buscar Funcion√°rio</h2>
          <p class="card-subtitle">Digite nome ou ID para localizar</p>

          <div class="search-section">
            <label class="search-label">Buscar por Nome</label>
            <input type="text" class="search-input" id="searchName" placeholder="Digite pelo menos 3 caracteres...">
            <div class="suggestions" id="suggestionsName"></div>
          </div>

          <div class="search-section">
            <label class="search-label">Buscar por ID</label>
            <input type="text" class="search-input" id="searchId" placeholder="Digite o ID do funcion√°rio...">
            <div class="suggestions" id="suggestionsId"></div>
          </div>
        </div>

        <div class="card" id="selectedEmployeeCard" style="display: none;">
          <div class="selected-employee">
            <div class="selected-header">
              <div>
                <div class="selected-title">‚úì Funcion√°rio Selecionado</div>
                <div class="selected-name" id="selectedName">-</div>
                <div class="selected-id">ID: <span id="selectedId">-</span></div>
              </div>
              <button class="btn-clear" onclick="clearSelection()">‚úï Limpar</button>
            </div>
            <div class="selected-details">
              <div class="detail-item">
                <div class="detail-label">E-mail</div>
                <div class="detail-value" id="selectedEmail">-</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">WhatsApp</div>
                <div class="detail-value" id="selectedWhatsApp">-</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Cargo</div>
                <div class="detail-value" id="selectedRole">-</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Carga Hor√°ria</div>
                <div class="detail-value" id="selectedCarga">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="actions-menu" id="actionsMenu">
        <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 20px; text-align: center;">
          ‚ö° Escolha uma A√ß√£o
        </h2>
        
        <div class="actions-section">
          <button class="action-btn" onclick="openForm('lancar')">
            <span class="action-icon">üìù</span>
            <span class="action-text">Lan√ßar Ponto Antigo</span>
          </button>

          <button class="action-btn" onclick="openForm('espelho')">
            <span class="action-icon">üìÑ</span>
            <span class="action-text">Enviar Espelho de Ponto</span>
          </button>

          <button class="action-btn" onclick="openForm('atualizar')">
            <span class="action-icon">üë§</span>
            <span class="action-text">Atualizar Dados</span>
          </button>

          <button class="action-btn" onclick="openForm('promover')">
            <span class="action-icon">‚≠ê</span>
            <span class="action-text">Promover para Admin</span>
          </button>

          <button class="action-btn" onclick="openForm('excluir')">
            <span class="action-icon">üóëÔ∏è</span>
            <span class="action-text">Excluir Funcion√°rio</span>
          </button>
        </div>
      </div>

      <div class="card form-area" id="formLancar">
        <div class="form-header">
          <h2 class="form-title">üìù Lan√ßar Ponto Antigo</h2>
          <button class="btn-ghost" onclick="closeForm()">‚úï Fechar</button>
        </div>

        <div class="warning-box">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <div class="warning-text">
                <strong>Aten√ß√£o:</strong> Para lan√ßamentos no mesmo dia, √© obrigat√≥rio informar o hor√°rio de sa√≠da. <br>
                Para corre√ß√µes pontuais (apenas entrada ou apenas sa√≠da), recomendamos realizar o ajuste no dia seguinte para evitar inconsist√™ncias no c√°lculo de horas.
            </div>
        </div>

        <form id="formLancarSubmit">
          <div class="form-group">
            <label class="form-label">ID do Funcion√°rio</label>
            <input type="text" class="form-input" name="funcionario_id" placeholder="Digite o ID do funcion√°rio" required>
          </div>
          <div class="form-group">
            <label class="form-label">Data do Ponto</label>
            <input type="date" class="form-input" name="data" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Entrada</label>
              <input type="time" class="form-input" name="entrada" required>
            </div>
            <div class="form-group">
              <label class="form-label">Sa√≠da para Almo√ßo</label>
              <input type="time" class="form-input" name="saida_almoco">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Retorno do Almo√ßo</label>
              <input type="time" class="form-input" name="retorno_almoco">
            </div>
            <div class="form-group">
              <label class="form-label">Sa√≠da</label>
              <input type="time" class="form-input" name="saida" required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Observa√ß√µes</label>
            <textarea class="form-textarea" name="observacoes" placeholder="Informa√ß√µes adicionais..."></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Lan√ßar Ponto</button>
            <button type="button" class="btn btn-ghost" onclick="closeForm()">Cancelar</button>
          </div>
          <div class="message" id="messageLancar"></div>
        </form>
      </div>

      <div class="card form-area" id="formEspelho">
        <div class="form-header">
          <h2 class="form-title">üìÑ Enviar Espelho de Ponto</h2>
          <button class="btn-ghost" onclick="closeForm()">‚úï Fechar</button>
        </div>
        <form id="formEspelhoSubmit">
          <div class="form-group">
            <label class="form-label">ID do Funcion√°rio</label>
            <input type="text" class="form-input" name="funcionario_id" placeholder="Digite o ID do funcion√°rio" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">M√™s</label>
              <select class="form-select" name="mes" required>
                <option value="">Selecione</option>
                <option value="01">Janeiro</option>
                <option value="02">Fevereiro</option>
                <option value="03">Mar√ßo</option>
                <option value="04">Abril</option>
                <option value="05">Maio</option>
                <option value="06">Junho</option>
                <option value="07">Julho</option>
                <option value="08">Agosto</option>
                <option value="09">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Ano</label>
              <input type="number" class="form-input" name="ano" min="2023" max="2030" value="2025" required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">E-mail para Envio</label>
            <input type="email" class="form-input" name="email" placeholder="email@exemplo.com" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Enviar Espelho</button>
            <button type="button" class="btn btn-ghost" onclick="closeForm()">Cancelar</button>
          </div>
          <div class="message" id="messageEspelho"></div>
        </form>
      </div>

      <div class="card form-area" id="formAtualizar">
        <div class="form-header">
          <h2 class="form-title">üë§ Atualizar Dados do Funcion√°rio</h2>
          <button class="btn-ghost" onclick="closeForm()">‚úï Fechar</button>
        </div>
        <form id="formAtualizarSubmit">
          <div class="form-group">
            <label class="form-label">ID do Funcion√°rio</label>
            <input type="text" class="form-input" name="funcionario_id" placeholder="Digite o ID do funcion√°rio" required>
          </div>
          <div class="form-group">
            <label class="form-label">Nome Completo</label>
            <input type="text" class="form-input" name="nome" placeholder="Nome completo do funcion√°rio">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">E-mail</label>
              <input type="email" class="form-input" name="email" placeholder="email@exemplo.com">
            </div>
            <div class="form-group">
              <label class="form-label">WhatsApp</label>
              <input type="tel" class="form-input" name="whatsapp" placeholder="(00) 00000-0000">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Carga Hor√°ria Di√°ria (horas)</label>
            <input type="number" class="form-input" name="carga_horaria" min="0" step="0.5" placeholder="8">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar Altera√ß√µes</button>
            <button type="button" class="btn btn-ghost" onclick="closeForm()">Cancelar</button>
          </div>
          <div class="message" id="messageAtualizar"></div>
        </form>
      </div>

      <div class="card form-area" id="formPromover">
        <div class="form-header">
          <h2 class="form-title">‚≠ê Promover para Administrador</h2>
          <button class="btn-ghost" onclick="closeForm()">‚úï Fechar</button>
        </div>
        <form id="formPromoverSubmit">
          <div class="form-group">
            <label class="form-label">ID do Funcion√°rio</label>
            <input type="text" class="form-input" name="funcionario_id" placeholder="Digite o ID do funcion√°rio" required>
          </div>
          <div style="padding: 20px; background: rgba(249, 61, 0, 0.1); border: 1px solid rgba(249, 61, 0, 0.3); border-radius: 12px; margin-bottom: 20px;">
            <p style="margin-bottom: 12px; font-weight: 600; color: var(--laranja);">‚ö†Ô∏è Aten√ß√£o!</p>
            <p style="font-size: 14px; line-height: 1.6; color: #e0e0e0;">
              Voc√™ est√° prestes a promover este funcion√°rio para Administrador. 
              Esta a√ß√£o conceder√° acesso total ao sistema, incluindo este painel administrativo.
            </p>
          </div>
          <div class="form-group">
            <label class="form-label">Confirme digitando "PROMOVER"</label>
            <input type="text" class="form-input" name="confirmacao" placeholder="Digite PROMOVER para confirmar" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Confirmar Promo√ß√£o</button>
            <button type="button" class="btn btn-ghost" onclick="closeForm()">Cancelar</button>
          </div>
          <div class="message" id="messagePromover"></div>
        </form>
      </div>

      <div class="card form-area" id="formExcluir">
        <div class="form-header">
          <h2 class="form-title">üóëÔ∏è Excluir Funcion√°rio</h2>
          <button class="btn-ghost" onclick="closeForm()">‚úï Fechar</button>
        </div>
        <form id="formExcluirSubmit">
          <div class="form-group">
            <label class="form-label">ID do Funcion√°rio</label>
            <input type="text" class="form-input" name="funcionario_id" placeholder="Digite o ID do funcion√°rio" required>
          </div>
          <div style="padding: 20px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; margin-bottom: 20px;">
            <p style="margin-bottom: 12px; font-weight: 600; color: #f87171;">üö® A√ß√£o Irrevers√≠vel!</p>
            <p style="font-size: 14px; line-height: 1.6; color: #e0e0e0;">
              Voc√™ est√° prestes a excluir permanentemente este funcion√°rio e todos os seus registros de ponto. 
              Esta a√ß√£o <strong>N√ÉO PODE</strong> ser desfeita.
            </p>
          </div>
          <div class="form-group">
            <label class="form-label">Motivo da Exclus√£o</label>
            <textarea class="form-textarea" name="motivo" placeholder="Descreva o motivo..." required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Confirme digitando "EXCLUIR PERMANENTEMENTE"</label>
            <input type="text" class="form-input" name="confirmacao" placeholder="Digite EXCLUIR PERMANENTEMENTE" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="flex: 1; background: #ef4444;">Excluir Permanentemente</button>
            <button type="button" class="btn btn-ghost" onclick="closeForm()">Cancelar</button>
          </div>
          <div class="message" id="messageExcluir"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ========== CONFIGURA√á√ÉO DOS WEBHOOKS ==========
    const WEBHOOKS = {
      lancar: 'https://n8n.upperfy.com.br/webhook/clock2',
      espelho: 'https://n8n.upperfy.com.br/webhook/clock3',
      atualizar: 'https://n8n.upperfy.com.br/webhook/clock4',
      promover: 'https://n8n.upperfy.com.br/webhook/clock5',
      excluir: 'https://n8n.upperfy.com.br/webhook/clock6'
    };

    const WEBHOOK_SEARCH = 'https://n8n.upperfy.com.br/webhook/b9750986-24a2-46f5-820f-clockadminsearch';
    
    // ========== VARI√ÅVEIS GLOBAIS ==========
    let selectedEmployee = null;
    let searchTimeout = null;
    let currentForm = null;

    // ========== ELEMENTOS DO DOM ==========
    const searchName = document.getElementById('searchName');
    const searchId = document.getElementById('searchId');
    const suggestionsName = document.getElementById('suggestionsName');
    const suggestionsId = document.getElementById('suggestionsId');
    const actionsMenu = document.getElementById('actionsMenu');

    // ========== FUN√á√ïES DE BUSCA ==========
    searchName.addEventListener('input', (e) => {
      const query = e.target.value.trim();
      if (query.length >= 3) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchEmployees('nome', query, suggestionsName);
        }, 300);
      } else {
        suggestionsName.classList.remove('show');
        suggestionsName.innerHTML = '';
      }
    });

    searchId.addEventListener('input', (e) => {
      const query = e.target.value.trim();
      if (query.length >= 1) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchEmployees('id', query, suggestionsId);
        }, 300);
      } else {
        suggestionsId.classList.remove('show');
        suggestionsId.innerHTML = '';
      }
    });

    async function searchEmployees(type, query, suggestionsElement) {
      suggestionsElement.innerHTML = '<div class="no-results">üîç Buscando...</div>';
      suggestionsElement.classList.add('show');

      try {
        const localStorageData = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          localStorageData[key] = localStorage.getItem(key);
        }

        const payload = {
          ...localStorageData,
          tipo_busca: type,
          busca: query
        };

        const response = await fetch(WEBHOOK_SEARCH, {
          method: 'POST',
          mode: 'cors',
          headers: { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error(`Erro HTTP: ${response.status}`);
        }

        const textResponse = await response.text();
        const data = JSON.parse(textResponse);

        let employees;
        if (Array.isArray(data)) {
          employees = data;
        } else if (data && typeof data === 'object') {
          employees = [data];
        } else {
          employees = [];
        }

        displaySuggestions(employees, suggestionsElement);

      } catch (error) {
        suggestionsElement.innerHTML = `<div class="no-results">‚ùå Erro ao buscar funcion√°rio</div>`;
      }
    }

    function displaySuggestions(employees, suggestionsElement) {
      if (!employees || !Array.isArray(employees) || employees.length === 0) {
        suggestionsElement.innerHTML = '<div class="no-results">üòï Nenhum funcion√°rio encontrado</div>';
        return;
      }

      const html = employees.map((emp) => {
        const empJson = JSON.stringify(emp).replace(/'/g, "\\'");
        return `
          <div class="suggestion-item" onclick='selectEmployee(${empJson})'>
            <div class="suggestion-name">${emp.nome_completo || emp.nome || 'Sem nome'}</div>
            <div class="suggestion-info">
              ID: ${emp.id || emp.id_funcionario || 'N/A'} ‚Ä¢ 
              ${emp.email || 'Sem email'} ‚Ä¢ 
              ${emp.role || emp.nivel_acesso || 'Funcion√°rio'}
            </div>
          </div>
        `;
      }).join('');

      suggestionsElement.innerHTML = html;
    }

    function selectEmployee(employee) {
      selectedEmployee = employee;
      
      document.getElementById('selectedName').textContent = employee.nome_completo || employee.nome;
      document.getElementById('selectedId').textContent = employee.id || employee.id_funcionario;
      document.getElementById('selectedEmail').textContent = employee.email || '-';
      document.getElementById('selectedWhatsApp').textContent = employee.numero_whatsapp || employee.whatsapp || '-';
      document.getElementById('selectedRole').textContent = employee.role || employee.nivel_acesso || 'Funcion√°rio';
      document.getElementById('selectedCarga').textContent = (employee.carga_horaria_diaria || employee.carga_horaria || '0') + 'h';
      
      document.getElementById('selectedEmployeeCard').style.display = 'block';
      actionsMenu.classList.add('show');
      
      suggestionsName.classList.remove('show');
      suggestionsId.classList.remove('show');
      suggestionsName.innerHTML = '';
      suggestionsId.innerHTML = '';
      
      searchName.value = '';
      searchId.value = '';

      setTimeout(() => {
        actionsMenu.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
    }

    function clearSelection() {
      selectedEmployee = null;
      document.getElementById('selectedEmployeeCard').style.display = 'none';
      actionsMenu.classList.remove('show');
      closeForm();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ========== FUN√á√ïES DE FORMUL√ÅRIO ==========
    function openForm(formType) {
      document.querySelectorAll('.form-area').forEach(form => {
        form.classList.remove('show');
      });

      const formId = `form${formType.charAt(0).toUpperCase() + formType.slice(1)}`;
      const form = document.getElementById(formId);
      
      if (form) {
        form.classList.add('show');
        currentForm = formType;
        
        if (selectedEmployee) {
          const funcionarioIdInput = form.querySelector('[name="funcionario_id"]');
          if (funcionarioIdInput) {
            funcionarioIdInput.value = selectedEmployee.id || selectedEmployee.id_funcionario || '';
          }
        }
        
        const messageId = `message${formType.charAt(0).toUpperCase() + formType.slice(1)}`;
        const messageElement = document.getElementById(messageId);
        if (messageElement) {
          messageElement.classList.remove('show');
        }

        setTimeout(() => {
          form.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      }
    }

    function closeForm() {
      document.querySelectorAll('.form-area').forEach(form => {
        form.classList.remove('show');
      });
      
      currentForm = null;

      if (selectedEmployee) {
        setTimeout(() => {
          actionsMenu.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      }
    }

    // ========== FUN√á√ÉO GEN√âRICA DE ENVIO ==========
    async function submitForm(formType, formData) {
      const webhookUrl = WEBHOOKS[formType];
      
      if (!webhookUrl) {
        throw new Error('Webhook n√£o configurado para esta a√ß√£o');
      }

      try {
        const response = await fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();
        return data;
      } catch (error) {
        console.error('‚ùå Erro ao enviar:', error);
        throw error;
      }
    }

    // ========== SUBMISS√ÉO DE FORMUL√ÅRIOS ==========

    document.getElementById('formLancarSubmit').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      const formData = {
        acao: 'lancar_ponto',
        funcionario_id: form.funcionario_id.value,
        data: form.data.value,
        entrada: form.entrada.value,
        saida_almoco: form.saida_almoco.value,
        retorno_almoco: form.retorno_almoco.value,
        saida: form.saida.value,
        observacoes: form.observacoes.value,
        timestamp: new Date().toISOString()
      };

      try {
        const response = await submitForm('lancar', formData);
        
        if (response.sucesso || response.success) {
          showMessage('messageLancar', response.mensagem || 'Ponto lan√ßado com sucesso!', 'success');
          form.reset();
          setTimeout(() => closeForm(), 2000);
        } else {
          showMessage('messageLancar', response.mensagem || 'Erro ao processar. Revise os dados.', 'error');
        }
      } catch (error) {
        showMessage('messageLancar', 'Erro ao enviar requisi√ß√£o. Revise os dados.', 'error');
      }
    });

    document.getElementById('formEspelhoSubmit').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      
      // Coleta dados do localStorage
      const localStorageData = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        localStorageData[key] = localStorage.getItem(key);
      }
      
      const formData = {
        ...localStorageData,
        acao: 'enviar_espelho',
        funcionario_id: form.funcionario_id.value,
        mes: form.mes.value,
        ano: form.ano.value,
        email: form.email.value,
        timestamp: new Date().toISOString()
      };

      try {
        const response = await submitForm('espelho', formData);
        
        if (response.sucesso || response.success) {
          showMessage('messageEspelho', response.mensagem || 'Espelho enviado com sucesso!', 'success');
          form.reset();
          setTimeout(() => closeForm(), 2000);
        } else {
          showMessage('messageEspelho', response.mensagem || 'Erro ao processar. Revise os dados.', 'error');
        }
      } catch (error) {
        showMessage('messageEspelho', 'Erro ao enviar requisi√ß√£o. Revise os dados.', 'error');
      }
    });

    document.getElementById('formAtualizarSubmit').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      const formData = {
        acao: 'atualizar_dados',
        funcionario_id: form.funcionario_id.value,
        nome: form.nome.value,
        email: form.email.value,
        whatsapp: form.whatsapp.value,
        carga_horaria: form.carga_horaria.value,
        timestamp: new Date().toISOString()
      };

      try {
        const response = await submitForm('atualizar', formData);
        
        if (response.sucesso || response.success) {
          showMessage('messageAtualizar', response.mensagem || 'Dados atualizados com sucesso!', 'success');
          setTimeout(() => closeForm(), 2000);
        } else {
          showMessage('messageAtualizar', response.mensagem || 'Erro ao processar. Revise os dados.', 'error');
        }
      } catch (error) {
        showMessage('messageAtualizar', 'Erro ao enviar requisi√ß√£o. Revise os dados.', 'error');
      }
    });

    document.getElementById('formPromoverSubmit').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      const confirmText = form.confirmacao.value;
      
      if (confirmText !== 'PROMOVER') {
        showMessage('messagePromover', 'Digite PROMOVER para confirmar a a√ß√£o.', 'error');
        return;
      }
      
      const formData = {
        acao: 'promover_admin',
        funcionario_id: form.funcionario_id.value,
        confirmacao: confirmText,
        timestamp: new Date().toISOString()
      };

      try {
        const response = await submitForm('promover', formData);
        
        if (response.sucesso || response.success) {
          showMessage('messagePromover', response.mensagem || 'Funcion√°rio promovido com sucesso!', 'success');
          form.reset();
          setTimeout(() => closeForm(), 2000);
        } else {
          showMessage('messagePromover', response.mensagem || 'Erro ao processar. Revise os dados.', 'error');
        }
      } catch (error) {
        showMessage('messagePromover', 'Erro ao enviar requisi√ß√£o. Revise os dados.', 'error');
      }
    });

    document.getElementById('formExcluirSubmit').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      const confirmText = form.confirmacao.value;
      
      if (confirmText !== 'EXCLUIR PERMANENTEMENTE') {
        showMessage('messageExcluir', 'Digite EXCLUIR PERMANENTEMENTE para confirmar.', 'error');
        return;
      }
      
      const formData = {
        acao: 'excluir_funcionario',
        funcionario_id: form.funcionario_id.value,
        motivo: form.motivo.value,
        confirmacao: confirmText,
        timestamp: new Date().toISOString()
      };

      try {
        const response = await submitForm('excluir', formData);
        
        if (response.sucesso || response.success) {
          showMessage('messageExcluir', response.mensagem || 'Funcion√°rio exclu√≠do com sucesso!', 'success');
          form.reset();
          setTimeout(() => closeForm(), 2000);
        } else {
          showMessage('messageExcluir', response.mensagem || 'Erro ao processar. Revise os dados.', 'error');
        }
      } catch (error) {
        showMessage('messageExcluir', 'Erro ao enviar requisi√ß√£o. Revise os dados.', 'error');
      }
    });

    // ========== FUN√á√ïES AUXILIARES ==========
    function showMessage(elementId, text, type) {
      const messageElement = document.getElementById(elementId);
      messageElement.textContent = text;
      messageElement.className = `message ${type} show`;
      
      setTimeout(() => {
        messageElement.classList.remove('show');
      }, 5000);
    }

    function logout() {
      if (confirm('Deseja realmente sair?')) {
        localStorage.clear();
        window.location.href = '../index.html';
      }
    }

    // ========== INICIALIZA√á√ÉO ==========
    console.log('‚úÖ Painel Admin carregado');
    console.log('üìç Webhooks configurados:', WEBHOOKS);
  </script>
</body>
</html>
